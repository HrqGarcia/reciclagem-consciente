<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Reciclagem Consciente</title>
    <link rel="stylesheet" href="/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <header>
        <nav>
            <div class="logo">Reciclagem Consciente ♻️</div>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="pontos.html">Pontos de Coleta</a></li>
                <li><a href="#" id="btnLogout">Sair</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div style="max-width: 1000px; margin: 2rem auto; padding: 0 5%;">
            <h1>Olá, <span id="userName">Usuário</span>!</h1>
            <p>Gerencie suas coletas e acompanhe seus pontos.</p>
        </div>

        <!-- Seção de Agendamento -->
        <section id="agendar" class="form-section">
            <h2>Novo Agendamento</h2>
            <form id="agendamentoForm">
                <div class="form-group">
                    <label for="nome">Nome Completo</label>
                    <input type="text" id="nome" required placeholder="Seu nome">
                </div>
                <div class="form-group">
                    <label for="endereco">Endereço de Coleta</label>
                    <input type="text" id="endereco" required placeholder="Rua, Número, Bairro">
                </div>
                <div class="form-group">
                    <label for="data">Data da Coleta</label>
                    <input type="date" id="data" required>
                </div>
                <div class="form-group">
                    <label for="tipo_material">Tipo de Material</label>
                    <select id="tipo_material" required>
                        <option value="">Selecione...</option>
                        <option value="Vidro">Vidro</option>
                        <option value="Papel">Papel</option>
                        <option value="Plástico">Plástico</option>
                        <option value="Metal">Metal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="peso_estimado">Peso Estimado (kg)</label>
                    <input type="number" id="peso_estimado" step="0.1" min="0.1" required placeholder="Ex: 2.5">
                </div>
                <button type="submit" class="btn-submit">Confirmar Agendamento</button>
            </form>
        </section>

        <!-- Seção Dashboard -->
        <section id="dashboard" class="dashboard-section">
            <h2>Meus Pontos</h2>
            <div class="stats">
                <div class="stat-card">
                    <h3>Total de EcoPoints</h3>
                    <p id="total-points">0</p>
                </div>
                <div class="stat-card">
                    <h3>Coletas Agendadas</h3>
                    <p id="total-coletas">0</p>
                </div>
            </div>

            <h3>Histórico de Agendamentos</h3>
            <div class="table-container">
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Material</th>
                            <th>Peso (kg)</th>
                            <th>Pontos</th>
                            <th>Status e Ponto</th>
                        </tr>
                    </thead>
                    <tbody id="agendamentos-list">
                        <!-- Preenchido via JS -->
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <script src="/app.js"></script>
    <script>
        // Lógica de Logout específica
        document.getElementById('btnLogout').addEventListener('click', async (e) => {
            e.preventDefault();
            await fetch('/api/logout', { method: 'POST' });
            window.location.href = 'index.html';
        });

        // Verificar sessão ao carregar
        fetch('/api/session')
            .then(res => res.json())
            .then(data => {
                if (!data.loggedIn) {
                    window.location.href = 'login.html';
                } else {
                    document.getElementById('userName').innerText = data.user.nome;
                    // Preencher nome no formulário se possível
                    document.getElementById('nome').value = data.user.nome;
                }
            });
    </script>
</body>

</html>